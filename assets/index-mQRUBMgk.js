(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();function H(e){return typeof window<"u"&&window.location.hostname==="itsecretary-map.github.io"?`/chromecast_stream/images/slideshow/${e}`:`./images/slideshow/${e}`}const T=[{ar:"إِنَّ الصَّلَاةَ تَنْهَىٰ عَنِ الْفَحْشَاءِ وَالْمُنكَرِ",en:"Indeed, prayer prohibits immorality and wrongdoing. (Quran 29:45)"},{ar:"خَيْرُكُمْ أَحْسَنُكُمْ أَخْلَاقًا",en:"The best among you are those who have the best manners and character. (Bukhari)"},{ar:"فَاذْكُرُونِي أَذْكُرْكُمْ",en:"So remember Me; I will remember you. (Quran 2:152)"},{ar:"مَنْ لَا يَشْكُرِ النَّاسَ لَا يَشْكُرِ اللَّهَ",en:"Whoever does not thank people has not thanked Allah. (Tirmidhi)"},{ar:"وَوَجَدَكَ ضَالًّا فَهَدَىٰ",en:"And He found you lost and guided [you]. (Quran 93:7)"},{ar:"لَيْسَ الشَّدِيدُ بِالصُّرَعَةِ، إِنَّمَا الشَّدِيدُ الَّذِي يَمْلِكُ نَفْسَهُ عِندَ الْغَضَبِ",en:"The strong man is not the one who can overpower others. The strong man is the one who controls himself when angry. (Bukhari)"},{ar:"وَلَسَوْفَ يُعْطِيكَ رَبُّكَ فَتَرْضَىٰ",en:"And your Lord is going to give you, and you will be satisfied. (Quran 93:5)"},{ar:"يَسِّرُوا وَلَا تُعَسِّرُوا",en:"Make things easy and do not make them difficult. (Bukhari)"},{ar:"وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ",en:"And whoever puts his trust in Allah, then He will suffice him. (Quran 65:3)"},{ar:"لَا يُؤْمِنُ أَحَدُكُمْ حَتَّى يُحِبَّ لأَخِيهِ مَا يُحِبُّ لِنَفْسِهِ",en:"None of you truly believes until he loves for his brother what he loves for himself. (Bukhari & Muslim)"}];function G(){const e=typeof window<"u"&&(window.location.hostname==="itsecretary-map.github.io"||window.location.pathname.includes("/chromecast_stream/")||window.location.href.includes("github.io"));return console.log("🔍 GitHub Pages detection:",{hostname:window.location.hostname,pathname:window.location.pathname,href:window.location.href,isGitHubPages:e}),e?{mapWebsite:"/chromecast_stream/images/qr-codes/mapitt.png",communityWhatsApp:"/chromecast_stream/images/qr-codes/whatsapp_group.png"}:{mapWebsite:"./images/qr-codes/mapitt.png",communityWhatsApp:"./images/qr-codes/whatsapp_group.png"}}const A={mapWebsite:"Website",communityWhatsApp:"WhatsApp"},$={owner:"itsecretary-map",repo:"chromecast_stream",folder:"images/slideshow",enabled:!0};function N(){const e=window.innerWidth,t=window.innerHeight;console.log(`🔒 Detected screen dimensions: ${e}x${t}`),document.documentElement.style.transform="none",document.body.style.transform="none"}window.addEventListener("load",()=>{console.log("📱 Page loaded, locking viewport dimensions..."),N()});let l=[];const C="github_images_cache",S=1440*60*1e3;async function O(){try{const e=localStorage.getItem(C);if(e){const o=JSON.parse(e),s=Date.now();if(s-o.timestamp<S)return console.log("📦 Using cached GitHub images (age:",Math.round((s-o.timestamp)/1e3/60),"minutes)"),o.images;console.log("⏰ Cache expired, fetching fresh images from GitHub")}const t=await L();if(t.length>0){const o={images:t,timestamp:Date.now()};localStorage.setItem(C,JSON.stringify(o)),console.log("💾 Cached fresh GitHub images")}return t}catch(e){console.error("❌ Error in cache management:",e);const t=localStorage.getItem(C);if(t){const o=JSON.parse(t);return console.log("🔄 Using expired cache as fallback"),o.images}return[]}}async function L(){try{const e=`https://api.github.com/repos/${$.owner}/${$.repo}/contents/${$.folder}`;console.log("Fetching images from GitHub:",e);const t=await fetch(e);if(!t.ok){if(t.status===404)return console.warn("⚠️ GitHub folder not found:",e),console.log("This is expected if the folder is empty or doesn't exist"),[];throw new Error(`GitHub API error: ${t.status} ${t.statusText}`)}const o=await t.json();console.log("GitHub API response:",o),console.log("📁 All files returned from GitHub:",o.map(n=>n.name));const s=o.filter(n=>{const r=n.name.toLowerCase().split(".").pop(),a=["jpg","jpeg","png","gif","webp"].includes(r),h=!n.name.includes("CCA_5344-HDR");return console.log(`🔍 File: ${n.name}, isImage: ${a}, isNotBackground: ${h}`),a&&h});console.log(`✅ Found ${s.length} valid slideshow image files:`,s);const i=s.map(n=>({id:n.sha,name:n.name,url:n.download_url}));return console.log("GitHub images processed:",i),i}catch(e){return console.error("Error fetching GitHub images:",e),console.log("Falling back to default slideshow images"),[]}}function Q(){localStorage.removeItem(C),console.log("🗑️ Image cache cleared")}function W(){if(window.location.hostname==="localhost"||window.location.hostname.includes("github.io")||window.innerWidth>=1920||window.innerHeight>=1080){console.log("📺 Chromecast Receiver Mode Detected"),console.log("  - Screen size:",window.innerWidth,"x",window.innerHeight),console.log("  - Hostname:",window.location.hostname),q();const t=document.querySelector(".chromecast-controls");t&&(t.style.display="none",console.log("🎯 Hidden Chromecast sender controls for receiver mode"))}else console.log("💻 Sender Mode Detected (showing cast controls)")}function q(){const e=document.body;e.style.fontSize=window.innerWidth>=3840?"32px":"24px";const t=document.querySelector(".slideshow img");t&&(t.style.borderRadius="16px",t.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.6)"),console.log("🎨 TV display optimizations applied (CSS-preserving)")}function D(){const e=window.innerWidth/window.innerHeight;window.innerWidth>=1920&&(console.log(`TV detected: ${window.innerWidth}x${window.innerHeight}, aspect ratio: ${e.toFixed(2)}`),e<=16/9?(document.documentElement.style.setProperty("--header-height","10vh"),document.documentElement.style.setProperty("--ayats-height","10vh"),document.documentElement.style.setProperty("--content-height","70vh"),document.documentElement.style.setProperty("--gap","2vh"),document.documentElement.style.setProperty("--padding","2vh"),console.log("Applied 16:9 TV optimization (percentage-based layout)")):(document.documentElement.style.setProperty("--header-height","8vh"),document.documentElement.style.setProperty("--ayats-height","8vh"),document.documentElement.style.setProperty("--content-height","74vh"),document.documentElement.style.setProperty("--gap","2vh"),document.documentElement.style.setProperty("--padding","2vh"),console.log("Applied ultra-wide TV optimization (percentage-based layout)")))}window.addEventListener("load",D);window.addEventListener("resize",D);let c=0;const g=document.getElementById("slideshow-img");let P=0;function p(e){if(l.length===0){console.log("No images available to show");return}console.log(`Showing image ${e+1} of ${l.length}:`,l[e]),g.style.opacity=0;let t=document.getElementById("slideshow-error");t&&t.remove(),setTimeout(()=>{const o=l[e];console.log("Setting image src to:",o),g.src=o,g.onload=()=>{console.log("Image loaded successfully:",o),g.style.opacity=1},g.onerror=()=>{if(console.error("Image failed to load:",o),g.style.opacity=.2,!document.getElementById("slideshow-error")){const s=document.createElement("div");s.id="slideshow-error",s.style.color="red",s.style.textAlign="center",s.style.marginTop="10px",s.textContent="Image failed to load. Check the image URL or try another image.",g.parentNode.appendChild(s)}}},300)}function z(){l.length!==0&&(c===l.length-1&&(P++,console.log(`🔄 Completed rotation ${P} through ${l.length} images`),_()),c=(c+1)%l.length,p(c))}async function _(){console.log("🔄 Refreshing slideshow images after completing rotation...");try{Q();const e=await L();if(e.length>0){const t=l.length;l=e.map(o=>o.url),console.log(`✅ Refreshed slideshow: ${t} → ${l.length} images`),c=0,p(c),l.length>t&&console.log(`🎉 Found ${l.length-t} new images!`)}else console.log("⚠️ No fresh images found, keeping current set")}catch(e){console.error("❌ Error refreshing images after rotation:",e),console.log("🔄 Continuing with current image set")}}async function U(){try{console.log("Initializing slideshow with GitHub images..."),Q();const e=await O();e.length>0?(l=e.map(t=>t.url),console.log(`Updated slideshow with ${l.length} images from GitHub`),l.length>0&&(c=0,p(c))):(console.log("No images found in GitHub repository"),l=R(),l.length>0&&(c=0,p(c)))}catch(e){console.error("Error initializing slideshow:",e),l=R(),l.length>0&&(c=0,p(c))}}setInterval(z,1e4);function R(){return[H("imam_schedule.jpg"),H("sundayschool.jpg")]}const v=document.getElementById("ayats-content");let b=0;function M(e){if(v){const o=T[e].en.replace(/[.]+(?=\s*\()/,"");v.innerHTML=`<div style="font-size:1rem;text-align:center;color:white;line-height:1.4;padding:15px;background:rgba(255,255,255,0.1);border-radius:8px;border-left:4px solid #2196F3;">${o}</div>`}}v&&(M(b),setInterval(()=>{b=(b+1)%T.length,M(b)},2e4));const k="15044",B="US",I=document.getElementById("prayer-times-list");fetch(`https://api.aladhan.com/v1/timingsByAddress?address=${k},${B}`).then(e=>e.json()).then(e=>{const t=e.data.timings;["Fajr","Dhuhr","Asr","Maghrib","Isha"].forEach(i=>{let n=t[i];if(n){let[a,h]=n.split(":"),d=parseInt(a,10),u="AM";d===0?d=12:d===12?u="PM":d>12&&(d-=12,u="PM"),n=`${d}:${h} ${u}`}const r=document.createElement("li");r.textContent=`${i}: ${n}`,I.appendChild(r)});const s=document.createElement("li");s.textContent="Jummah: 1:15 PM",I.appendChild(s)}).catch(()=>{[{name:"Fajr",time:"05:12 AM"},{name:"Dhuhr",time:"01:23 PM"},{name:"Asr",time:"05:07 PM"},{name:"Maghrib",time:"08:34 PM"},{name:"Isha",time:"10:02 PM"}].forEach(o=>{let[s,i,n]=o.time.match(/(\d+):(\d+)\s*(AM|PM)/i)||[],r=o.time;s&&i&&n&&(r=`${parseInt(s,10)}:${i} ${n.toUpperCase()}`);const a=document.createElement("li");a.textContent=`${o.name}: ${r}`,I.appendChild(a)});const t=document.createElement("li");t.textContent="Jummah: 1:15 PM",I.appendChild(t)});function x(){console.log("🔍 Rendering QR codes...");const e=document.querySelector(".qr-list");if(console.log("📍 QR list element:",e),e){const t=G();console.log("🖼️ QR image URLs:",t),t&&typeof t=="object"?(e.innerHTML="",Object.entries(t).forEach(([o,s],i)=>{console.log(`📱 Creating QR code ${i+1}:`,o,s);const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.marginBottom="18px";const r=document.createElement("div");r.textContent=A[o]||o.replace(/([A-Z])/g," $1").replace(/^./,d=>d.toUpperCase()),r.style.color="#ffd600",r.style.fontSize="1.1rem",r.style.marginBottom="8px",r.style.textAlign="center",r.style.wordBreak="break-word";const a=document.createElement("img");a.className="qr-img",a.alt=r.textContent,(d=>{const u=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",f=(m=>{switch(m){case"mapWebsite":return"mapitt.png";case"communityWhatsApp":return"whatsapp_group.png";default:return"mapitt.png"}})(d),y=u?[`./images/qr-codes/${f}`,`images/qr-codes/${f}`]:[`/chromecast_stream/images/qr-codes/${f}`,`./images/qr-codes/${f}`];y.unshift(s);let w=0;const E=()=>{if(w<y.length){const m=y[w];console.log(`🔄 Trying QR image path ${w+1}/${y.length}:`,m),a.src=m,w++}else{console.error(`❌ All paths failed for QR image: ${d}`);const m=document.createElement("div");m.textContent=`QR Code: ${A[o]||o}`,m.style.color="#ff6b6b",m.style.fontSize="0.8rem",m.style.textAlign="center",m.style.marginTop="5px",n.appendChild(m)}};a.onerror=()=>{console.error("❌ Failed to load QR image from path:",a.src),E()},a.onload=()=>{console.log(`✅ QR image loaded successfully: ${a.src}`),console.log("✅ Image element:",a),console.log("✅ Image dimensions:",a.naturalWidth,"x",a.naturalHeight)},E()})(o),console.log(`📸 Created image element for ${o}:`,a),console.log("🔗 Image src set to:",s),n.appendChild(r),n.appendChild(a),e.appendChild(n)}),console.log("✅ QR codes rendered successfully"),console.log("🔍 Final QR list HTML:",e.innerHTML),console.log("🔍 QR list children count:",e.children.length),console.log("🔍 All image elements in QR list:",e.querySelectorAll("img")),e.children.length===0&&(console.warn("⚠️ No QR codes rendered, retrying in 1 second..."),setTimeout(()=>{console.log("🔄 Retrying QR code rendering..."),x()},1e3))):console.error("❌ QR image URLs not available or invalid")}else console.error("❌ QR list element not found")}console.log("🚀 Initializing Chromecast Receiver Demo...");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("📄 DOM fully loaded, setting background image..."),setTimeout(()=>{x()},100)}):(console.log("📄 DOM already loaded, setting background image..."),setTimeout(()=>{x()},100));U();W();function F(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),o=t-e;console.log("🕛 Scheduling daily reload at midnight"),console.log("⏰ Current time:",e.toLocaleTimeString()),console.log("🌅 Next reload at:",t.toLocaleString()),console.log("⏳ Time until reload:",Math.round(o/1e3/60),"minutes"),setTimeout(()=>{console.log("🔄 Executing scheduled daily reload..."),window.location.reload()},o),setTimeout(()=>{F()},o)}F();console.log("🔧 Cache Management Commands Available:");console.log("  - getCacheInfo() - Check cache status");console.log("  - clearImageCache() - Clear image cache");console.log("  - forceRefreshImages() - Force refresh from GitHub");console.log("  - CACHE_DURATION:",Math.round(S/1e3/60),"minutes");console.log("✅ Initialization complete!");
